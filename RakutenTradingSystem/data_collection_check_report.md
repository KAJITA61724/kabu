# データ収集状況チェックレポート
**作成日時**: 2026年1月28日

## 📊 データベース状況サマリー

### 1. trading_data.db (メインデータベース)
- **ファイルサイズ**: 1.1 MB
- **総レコード数**: 6,219 件
- **収集期間**: 2025年7月7日 ～ 2025年7月18日 (10営業日)
- **収集銘柄数**: 7 銘柄

### 2. fundamental_data.db (ファンダメンタルデータ)
- **ファイルサイズ**: 20 KB
- **総レコード数**: 0 件 ⚠️
- **状態**: データなし

---

## 📈 収集された銘柄データ

### 銘柄別データ件数

| 銘柄コード | 銘柄名 | レコード数 | 取引日数 | タイムフレーム | 期間 |
|---------|-------|----------|---------|-------------|------|
| 4503 | アステラス製薬 | 656 | 10日 | 5m | 2025/07/07-07/18 |
| 6758 | ソニーG | 979 | 10日 | 5m + 5M | 2025/07/07-07/18 |
| 6861 | キーエンス | 983 | 10日 | 5m + 5M | 2025/07/07-07/18 |
| 7203 | トヨタ自動車 | 984 | 10日 | 5m + 5M | 2025/07/07-07/18 |
| 7974 | 任天堂 | 655 | 10日 | 5m | 2025/07/07-07/18 |
| 8306 | 三菱UFJ | 983 | 10日 | 5m + 5M | 2025/07/07-07/18 |
| 9984 | ソフトバンクG | 979 | 10日 | 5m + 5M | 2025/07/07-07/18 |

**合計**: 6,219 レコード

---

## 📅 日次データ収集状況

| 日付 | レコード数 | 収集銘柄数 | 1銘柄あたり平均 |
|------|-----------|----------|---------------|
| 2025-07-07 | 462 | 7 | 66 |
| 2025-07-08 | 459 | 7 | 66 |
| 2025-07-09 | 458 | 7 | 65 |
| 2025-07-10 | 459 | 7 | 66 |
| 2025-07-11 | 455 | 7 | 65 |
| 2025-07-14 | 792 | 7 | 113 ⬆️ |
| 2025-07-15 | 782 | 7 | 112 ⬆️ |
| 2025-07-16 | 783 | 7 | 112 ⬆️ |
| 2025-07-17 | 783 | 7 | 112 ⬆️ |
| 2025-07-18 | 786 | 7 | 112 ⬆️ |

**注意**: 7/14以降でレコード数が増加 → タイムフレーム混在 (5m と 5M の両方)

---

## 🔍 データ品質チェック

### ✅ 正常な点
1. **データベーステーブル構造**: 正しく設計されている
   - `chart_data`: symbol, datetime, timeframe, OHLCV + volume
   - `created_at`: データ収集時刻の記録あり

2. **データ整合性**: 
   - 全7銘柄で同じ期間のデータが存在
   - 欠損日なし（営業日ベース）
   - 各取引日で適切なレコード数（約65-112件/日/銘柄）

3. **価格データ**: 
   - OHLCV 全て収集済み
   - 出来高データも含まれる
   - 価格データは正常範囲（例: 任天堂 13,000円台）

### ⚠️ 注意が必要な点

#### 1. **タイムフレームの表記揺れ**
- `5m` と `5M` の両方が混在
- 影響銘柄: 6758, 6861, 7203, 8306, 9984
- 推奨: 統一された表記に修正すべき（`5M` に統一）

#### 2. **監視対象銘柄との差異**
- `prime_symbols.csv`: 219銘柄を定義
- 実際の収集: 7銘柄のみ
- **収集率**: 3.2% (7/219)

#### 3. **ファンダメンタルデータが空**
- `fundamental_data.db` にデータなし
- 収集スクリプトが未実行の可能性

#### 4. **CSVデータが存在しない**
- `config.json` で `csv_mode: true` 設定
- しかし `csv_data/` ディレクトリにファイルなし
- CSVエクスポート機能が動作していない

#### 5. **データ収集期間が古い**
- 最終収集日: 2025年7月18日
- 現在日: 2026年1月28日
- **約6ヶ月間データ更新なし**

---

## 🎯 問題点と改善提案

### 優先度: 高 🔴

1. **データ収集の再開**
   ```bash
   # データ収集を再実行
   cd /workspaces/kabu/RakutenTradingSystem
   python run_data_collection.py
   ```

2. **自動収集の設定確認**
   - cron設定の確認
   - データ収集サービスの状態確認
   ```bash
   crontab -l
   systemctl status data-collection.service
   ```

3. **収集対象銘柄の見直し**
   - 219銘柄全てを収集するか、対象を絞るか決定
   - リアルタイム取引に必要な銘柄を優先

### 優先度: 中 🟡

4. **タイムフレーム表記の統一**
   - データクレンジング: `5m` → `5M` に統一
   - 収集スクリプトの修正

5. **ファンダメンタルデータの収集開始**
   ```bash
   python fundamental_data_collector.py
   ```

6. **CSV出力機能の確認**
   - CSVエクスポートが正しく動作しているか確認
   - 必要に応じて修正

### 優先度: 低 🟢

7. **データバックアップ体制**
   - 定期的なバックアップの実装
   - `backup_database.sh` の実行確認

---

## 📋 推奨アクション

### 即座に実行すべきこと

1. **現在のデータ収集状況を確認**
   ```bash
   # 自動収集が動作しているか確認
   ps aux | grep data_collect
   
   # 最近のログ確認
   ls -lt logs/ | head -10
   ```

2. **最新データの収集を開始**
   ```bash
   # 手動でデータ収集実行
   python run_data_collection.py
   ```

3. **自動収集の再設定**
   - 平日9:00-15:30の取引時間に定期実行
   - システム起動時の自動開始

### データベース統計情報

```sql
-- 最新データの確認
SELECT symbol, MAX(datetime) as latest_data 
FROM chart_data 
GROUP BY symbol;

-- データの連続性チェック
SELECT date(datetime) as date, 
       COUNT(*) as records,
       COUNT(DISTINCT symbol) as symbols
FROM chart_data 
GROUP BY date(datetime)
ORDER BY date;
```

---

## ✅ 結論

### 現在の状態
- **データベース構造**: ✅ 正常
- **過去データの存在**: ✅ 7銘柄 × 10日分のデータあり
- **データ品質**: ✅ 基本的に問題なし
- **データの鮮度**: ❌ 約6ヶ月前のデータで停止
- **自動収集**: ❌ 動作していない可能性
- **ファンダメンタル**: ❌ データなし
- **CSV出力**: ❌ 動作していない

### 次のステップ
1. データ収集システムの再起動
2. 自動収集の設定確認と修正
3. リアルタイムデータの収集開始
4. ファンダメンタルデータの収集
5. モニタリング体制の構築

---

**チェック完了日時**: 2026-01-28
**レポート作成者**: GitHub Copilot
